(function(){"use strict";L.Icon.PieIcon=L.Icon.extend({options:{data:[],iconSize:[100,100],iconCenter:false,precision:2},createIcon:function(oldIcon){var svg=this._createSVG(oldIcon);this._createSlices(svg);return svg},_createSVG:function(oldIcon){if(oldIcon){var g=oldIcon.querySelector("g");while(g.firstChild){g.removeChild(g.firstChild)}return oldIcon}var svg=document.createElementNS("http://www.w3.org/2000/svg","svg");var g=document.createElementNS("http://www.w3.org/2000/svg","g");var size=L.point(this.options.iconSize);svg.setAttribute("viewBox","-1 -1 2 2");svg.setAttribute("width",size.x.toString());svg.setAttribute("height",size.y.toString());svg.setAttribute("overflow","visible");svg.setAttribute("class","leaflet-marker-icon "+(this.options.className||""));if(this.options.iconCenter===true){g.setAttribute("transform","translate(-1 -1) rotate(-90)")}else{g.setAttribute("transform","rotate(-90)")}svg.appendChild(g);return svg},_createSlices:function(svg){var total=this._getTotal(this.options.data);this._cumulativePercent=0;this.options.data.forEach(this._createSlice.bind(this,svg,total))},_createSlice:function(svg,total,data){var start=this._getCoordinatesForPercent(this._cumulativePercent);var startX=start[0];var startY=start[1];var percent=data.value/total;data["percent"]=L.Util.formatNum(percent*100,this.options.precision);this._cumulativePercent+=percent;var end=this._getCoordinatesForPercent(this._cumulativePercent);var endX=end[0];var endY=end[1];var largeArcFlag=percent>.5?1:0;var pathData=["M "+startX+" "+startY,"A 1 1 0 "+largeArcFlag+" 1 "+endX+" "+endY,"L 0 0"].join(" ");var path=this._createPath(pathData,data.color,data.style||"");svg.querySelector("g").appendChild(path)},_createPath:function(d,color,style){var pathEl=document.createElementNS("http://www.w3.org/2000/svg","path");pathEl.setAttribute("d",d);pathEl.setAttribute("fill",color);pathEl.setAttribute("style",style);return pathEl},_getCoordinatesForPercent:function(percent){var x=Math.cos(2*Math.PI*percent);var y=Math.sin(2*Math.PI*percent);return[x,y]},_getTotal:function(data){return data.reduce(function(cumulat,data){return cumulat+data.value},0)}});L.Icon.pieIcon=function(options){return new L.Icon.PieIcon(options)}})();(function(){"use strict";L.Marker.PieMarker=L.Marker.extend({options:{iconOptions:{},icon:null},initialize:function(latlng,options){L.Util.setOptions(this,options);if(this.options.icon===null){options.icon=new L.Icon.PieIcon(options.iconOptions)}L.Marker.prototype.initialize.apply(this,[latlng,options])},_setPos:function(pos){var bbox=this._icon.getBoundingClientRect();pos.x-=Math.round(bbox.width/2);pos.y-=Math.round(bbox.height/2);L.DomUtil.setPosition(this._icon,pos);if(this._shadow){L.DomUtil.setPosition(this._shadow,pos)}this._zIndex=pos.y+this.options.zIndexOffset;this._resetZIndex()}});L.Marker.pieMarker=function(latlng,options){return new L.Marker.PieMarker(latlng,options)}})();